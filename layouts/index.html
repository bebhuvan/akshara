{{ define "main" }}
<!-- Header -->
{{ partial "header.html" . }}

<!-- Hero -->
<section class="hero">
    <div class="hero-content">
        <div class="hero-eyebrow">Project Akshara</div>
        <h1>Making India's <em>forgotten</em> books readable</h1>
        <p class="hero-intro">Reviving India's literary heritage from fading pages and forgotten archives.</p>

        <div class="hero-stats">
            {{ $allBooks := where .Site.Pages "Section" "books" }}
            {{ $allBooks = where $allBooks "Kind" "section" }}
            {{ $allBooks = where $allBooks "File.Path" "!=" "books/_index.md" }}
            {{ $bookCount := len $allBooks }}
            {{/* Count unique authors from books */}}
            {{ $authors := slice }}
            {{ range $allBooks }}
                {{ with .Params.author }}
                    {{ $authors = $authors | append . }}
                {{ end }}
            {{ end }}
            {{ $authorCount := len (uniq $authors) }}

            <div class="stat">
                <div class="stat-number">{{ $bookCount }}</div>
                <div class="stat-label">books digitized</div>
            </div>
            <div class="stat">
                <div class="stat-number">{{ $authorCount }}</div>
                <div class="stat-label">authors preserved</div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Book (Latest) -->
{{ $books := where .Site.Pages "Section" "books" }}
{{ $books = where $books "Kind" "section" }}
{{ $books = where $books "File.Path" "!=" "books/_index.md" }}
{{ $latestBook := index ($books.ByDate.Reverse) 0 }}
{{ with $latestBook }}
<section class="featured">
    <div class="featured-book">
        <div class="featured-visual">
            {{ with .Params.featured_quote }}
            <blockquote class="featured-quote">{{ . | markdownify }}</blockquote>
            {{ end }}
        </div>
        <div class="featured-content">
            <div class="featured-label">Recently Digitized</div>
            <h2 class="featured-title">{{ .Title }}</h2>
            <p class="featured-author">
                {{ if .Params.editor }}
                    Edited by {{ .Params.editor }}, {{ .Params.year }}
                {{ else }}
                    {{ .Params.author }}, {{ .Params.year }}
                {{ end }}
            </p>
            <p class="featured-excerpt">{{ .Params.description }}</p>
            <a href="{{ .RelPermalink }}" class="btn-primary">Begin Reading</a>
        </div>
    </div>
</section>
{{ end }}

<!-- Recent Books -->
<section class="recent">
    <div class="section-header">
        <h2 class="section-title">Recent Additions</h2>
        <a href="/books" class="section-link">View all books →</a>
    </div>

    <div class="books-grid">
        {{ $books := where .Site.Pages "Section" "books" }}
        {{ $books = where $books "Kind" "section" }}
        {{ $books := where $books "File.Path" "!=" "books/_index.md" }}
        {{ range first 12 ($books.ByDate.Reverse) }}
            {{ partial "book-card.html" . }}
        {{ end }}
    </div>
</section>

<!-- Collections -->
<section class="collections">
    <div class="collections-inner">
        <div class="section-header">
            <h2 class="section-title">Collections</h2>
            <a href="/collections" class="section-link">View all →</a>
        </div>

        <div class="collections-grid">
            {{ range $index, $page := (where .Site.RegularPages "Type" "collections") }}
            <a href="{{ .RelPermalink }}" class="collection-card">
                <div class="collection-number">{{ printf "%02d" (add $index 1) }}</div>
                <h3 class="collection-name">{{ .Title }}</h3>
                <div class="collection-count">{{ .Params.book_count }} Books</div>
                <p class="collection-description">{{ .Params.description }}</p>
            </a>
            {{ end }}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta">
    <div class="cta-content">
        <h2 class="cta-title">Want to help?</h2>
        <p class="cta-text">If you have rare PDFs to share, can help with OCR cleanup, or just want to follow along—I'd appreciate it.</p>
        <div class="cta-actions">
            <a href="/contact" class="btn-primary">Get in Touch</a>
        </div>
        <div class="newsletter-embed">
            <iframe src="https://bhuvan.substack.com/embed" width="100%" height="150" style="border:none; background:transparent;" frameborder="0" scrolling="no" loading="lazy" title="Subscribe to newsletter"></iframe>
        </div>
    </div>
</section>

<!-- Footer -->
{{ partial "footer.html" . }}
{{ end }}
